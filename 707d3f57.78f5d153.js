(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{146:function(e,t,n){"use strict";n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return m}));var a=n(0),o=n.n(a);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var p=o.a.createContext({}),s=function(e){var t=o.a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},b=function(e){var t=s(e.components);return o.a.createElement(p.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return o.a.createElement(o.a.Fragment,{},t)}},d=o.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,i=e.parentName,p=c(e,["components","mdxType","originalType","parentName"]),b=s(n),d=a,m=b["".concat(i,".").concat(d)]||b[d]||u[d]||r;return n?o.a.createElement(m,l(l({ref:t},p),{},{components:n})):o.a.createElement(m,l({ref:t},p))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=d;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var p=2;p<r;p++)i[p]=n[p];return o.a.createElement.apply(null,i)}return o.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},99:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return l})),n.d(t,"metadata",(function(){return c})),n.d(t,"rightToc",(function(){return p})),n.d(t,"default",(function(){return b}));var a=n(3),o=n(7),r=(n(0),n(146)),i=["components"],l={id:"deploy-on-gpu",title:"GPU applications"},c={unversionedId:"deploy-on-gpu",id:"deploy-on-gpu",isDocsHomePage:!1,title:"GPU applications",description:"By default you do not have the permission to run pods on GPU",source:"@site/docs/deploy-on-gpu.md",slug:"/deploy-on-gpu",permalink:"/dsri-documentation/docs/deploy-on-gpu",editUrl:"https://github.com/MaastrichtU-IDS/dsri-documentation/edit/master/website/docs/deploy-on-gpu.md",version:"current",lastUpdatedBy:"Vincent Emonet",lastUpdatedAt:1637661581,sidebar:"docs",previous:{title:"Imaging softwares",permalink:"/dsri-documentation/docs/catalog-imaging"},next:{title:"Utilities",permalink:"/dsri-documentation/docs/catalog-utilities"}},p=[{value:"JupyterLab on GPU",id:"jupyterlab-on-gpu",children:[{value:"TensorBoard logs visualization",id:"tensorboard-logs-visualization",children:[]},{value:"Increase the number of GPUs in your workspace",id:"increase-the-number-of-gpus-in-your-workspace",children:[]}]},{value:"Install GPU driver in any image",id:"install-gpu-driver-in-any-image",children:[]},{value:"Reserve GPU for your experiments",id:"reserve-gpu-for-your-experiments",children:[]}],s={rightToc:p};function b(e){var t=e.components,n=Object(o.a)(e,i);return Object(r.b)("wrapper",Object(a.a)({},s,n,{components:t,mdxType:"MDXLayout"}),Object(r.b)("div",{className:"admonition admonition-warning alert alert--danger"},Object(r.b)("div",{parentName:"div",className:"admonition-heading"},Object(r.b)("h5",{parentName:"div"},Object(r.b)("span",{parentName:"h5",className:"admonition-icon"},Object(r.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},Object(r.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"Request GPU access")),Object(r.b)("div",{parentName:"div",className:"admonition-content"},Object(r.b)("p",{parentName:"div"},Object(r.b)("strong",{parentName:"p"},"By default you do not have the permission to run pods on GPU")," "),Object(r.b)("p",{parentName:"div"},"If you want to run on GPU, ",Object(r.b)("strong",{parentName:"p"},"contact the ",Object(r.b)("a",{parentName:"strong",href:"mailto:dsri-support-l@maastrichtuniversity.nl"},"DSRI support team")),", they will create the templates you need to start applications on GPU."))),Object(r.b)("p",null,"We are using images provided by Nvidia, and optimized for GPU. We currently deployed Tensorflow and PyTorch with JupyterLab and VSCode, but any image available in the Nvidia catalog should be easy to deploy: ",Object(r.b)("a",{parentName:"p",href:"https://ngc.nvidia.com/catalog/containers"},"https://ngc.nvidia.com/catalog/containers")),Object(r.b)("p",null,"Checkout ",Object(r.b)("a",{parentName:"p",href:"https://github.com/MaastrichtU-IDS/jupyterlab#jupyterlab-on-gpu"},"this documentation")," for more details on how we build the optimized docker images for the DSRI GPUs. Feel free to extend the ",Object(r.b)("inlineCode",{parentName:"p"},"gpu.dockerfile")," to your needs."),Object(r.b)("h2",{id:"jupyterlab-on-gpu"},"JupyterLab on GPU"),Object(r.b)("p",null,"Once your project has been granted access to GPUs, you can deploy applications on GPU from the catalog:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"Go to the ",Object(r.b)("a",{parentName:"li",href:"https://console-openshift-console.apps.dsri2.unimaas.nl/console/catalog"},"Catalog web UI"),": ",Object(r.b)("strong",{parentName:"li"},"Add to Project")," > ",Object(r.b)("strong",{parentName:"li"},"Browse Catalog")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("strong",{parentName:"li"},"Filter"),' the catalog for  "',Object(r.b)("strong",{parentName:"li"},"GPU"),'"'),Object(r.b)("li",{parentName:"ul"},"Choose one of the available templates: ",Object(r.b)("strong",{parentName:"li"},"JupyterLab on GPU"),".")),Object(r.b)("p",null,"The following parameters can be provided:"),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},"Provide a unique ",Object(r.b)("strong",{parentName:"li"},"Application name")),Object(r.b)("li",{parentName:"ol"},"Provide a ",Object(r.b)("strong",{parentName:"li"},"Notebook token")," (password to access the notebook)"),Object(r.b)("li",{parentName:"ol"},"The ",Object(r.b)("strong",{parentName:"li"},"number of GPUs")," used by the application."),Object(r.b)("li",{parentName:"ol"},Object(r.b)("strong",{parentName:"li"},"Storage name"),": the storage Persistent Volume Claim (PVC)"),Object(r.b)("li",{parentName:"ol"},Object(r.b)("strong",{parentName:"li"},"Storage subpath"),": path to the Notebook folder in the Persistent Volume Claim storage")),Object(r.b)("p",null,"Now that your template is created and its accessible from the ",Object(r.b)("strong",{parentName:"p"},"Topology")," page of OpenShift web UI."),Object(r.b)("p",null,"You can now access the JupyterLab UI, install your dependencies and run your experiments."),Object(r.b)("p",null,"Use the ",Object(r.b)("strong",{parentName:"p"},Object(r.b)("inlineCode",{parentName:"strong"},"/workspace")," folder"),", which is the JupyterLab workspace, to store your code and data persistently, you can also take a look into the examples provided by Nvidia."),Object(r.b)("p",null,"Use the following command to see your current GPU usage:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-bash"},"nvidia-smi\n")),Object(r.b)("h3",{id:"tensorboard-logs-visualization"},"TensorBoard logs visualization"),Object(r.b)("p",null,"You can easily use ",Object(r.b)("a",{parentName:"p",href:"https://www.tensorflow.org/tensorboard"},Object(r.b)("strong",{parentName:"a"},"TensorBoard \ud83d\udcc8"))," to explore your machine learning runs. It is already pre-installed and ready-to-use in ouyr JupyterLab for GPU templates."),Object(r.b)("p",null,"All you need is to follow the usual process to run tensorboard: ",Object(r.b)("a",{parentName:"p",href:"https://www.tensorflow.org/tensorboard/get_started"},"https://www.tensorflow.org/tensorboard/get_started")),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},Object(r.b)("p",{parentName:"li"},"Add the tensorboard callback to your ",Object(r.b)("inlineCode",{parentName:"p"},"model.fit()")," function")),Object(r.b)("li",{parentName:"ol"},Object(r.b)("p",{parentName:"li"},"Then start Tensorboard in the terminal with ",Object(r.b)("inlineCode",{parentName:"p"},"tensorboard --logdir logs")," (change the directory depending on where the logs of your runs are stored), it should tell you that tensorboard as been started on port 6006")),Object(r.b)("li",{parentName:"ol"},Object(r.b)("p",{parentName:"li"},"Open the Tensorboard view from the JupyterLab welcome page"))),Object(r.b)("h3",{id:"increase-the-number-of-gpus-in-your-workspace"},"Increase the number of GPUs in your workspace"),Object(r.b)("p",null,"If you already have a application running using 1 GPU, and you have been granted a 2nd GPU to speed up your experiment you can easily upgrade the number of GPU used by your application:"),Object(r.b)("p",null,"From the ",Object(r.b)("strong",{parentName:"p"},"Topology")," view click on your application:"),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},"Stop the application, by decreasing the number of pod to 0 (in the ",Object(r.b)("strong",{parentName:"li"},"Details")," tab)"),Object(r.b)("li",{parentName:"ol"},"Click on ",Object(r.b)("strong",{parentName:"li"},"Options")," > ",Object(r.b)("strong",{parentName:"li"},"Edit Deployment")," > in the YAML of the deployment search for ",Object(r.b)("inlineCode",{parentName:"li"},"limits")," and change the number of GPU assigned to your deployment to 2:")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-yaml"},"          resources:\n            limits:\n              nvidia.com/gpu: '2'\n            requests:\n              nvidia.com/gpu: '2'\n")),Object(r.b)("ol",{start:3},Object(r.b)("li",{parentName:"ol"},"Restart the pod for your application (the same way you stopped it)")),Object(r.b)("h2",{id:"install-gpu-driver-in-any-image"},"Install GPU driver in any image"),Object(r.b)("p",null,"See the latest official ",Object(r.b)("a",{parentName:"p",href:"https://nvidia.github.io/nvidia-container-runtime"},"Nvidia docs")," to install the ",Object(r.b)("inlineCode",{parentName:"p"},"nvidia-container-runtime")," (all packages and drivers required to access the GPU from your application)"),Object(r.b)("p",null,"Here is an example of commands to add to a debian based ",Object(r.b)("inlineCode",{parentName:"p"},"Dockerfile")," to install the GPU drivers:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-dockerfile"},"RUN curl -s -L https://nvidia.github.io/nvidia-container-runtime/gpgkey | \\\n    apt-key add - \\ &&\n    distribution=$(. /etc/os-release;echo $ID$VERSION_ID) \\ &&\n    curl -s -L https://nvidia.github.io/nvidia-container-runtime/$distribution/nvidia-container-runtime.list | \nRUN apt-get update \\ &&\n    apt-get install -y nvidia-container-runtime\n")),Object(r.b)("p",null,"Then, build the FSL on GPU in your DSRI project using ",Object(r.b)("inlineCode",{parentName:"p"},"oc")," from the folder where your put the ",Object(r.b)("inlineCode",{parentName:"p"},"Dockerfile"),":"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-bash"},"oc new-build --name fsl-gpu --binary\noc start-build fsl-gpu --from-dir=. --follow --wait\noc new-app fsl-gpu\n")),Object(r.b)("p",null,"You will then need to edit the deployment to add the GPU NodeSelector, the ",Object(r.b)("inlineCode",{parentName:"p"},"serviceAccountName: anyuid")," and add a persistent storage"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-bash"},"oc edit fsl-gpu\n")),Object(r.b)("p",null,"See also: official ",Object(r.b)("a",{parentName:"p",href:"https://docs.nvidia.com/cuda/cuda-installation-guide-linux/index.html#debian-installation"},"Nvidia docs for CUDA")),Object(r.b)("h2",{id:"reserve-gpu-for-your-experiments"},"Reserve GPU for your experiments"),Object(r.b)("p",null,"Still experimental, you can check the availability of the 8 GPUs of the DSRI through the Maastricht University Outlook Calendar:"),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},"Go to the your UM Outlook Calendar (through the desktop or web application)"),Object(r.b)("li",{parentName:"ol"},'Create a new Calendar group named "DSRI GPUs"'),Object(r.b)("li",{parentName:"ol"},"Add the 8 ",Object(r.b)("inlineCode",{parentName:"li"},"EQUIP-PHS1-DSRIGPU")," numbered from 1 to 8, e.g. ",Object(r.b)("inlineCode",{parentName:"li"},"EQUIP-PHS1-DSRIGPU1-1P")," to this Calendar Group. This way you will be able to quickly see when a GPU is free or reserved")))}b.isMDXComponent=!0}}]);