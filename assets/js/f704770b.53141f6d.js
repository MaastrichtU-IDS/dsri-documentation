"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[3580],{3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>d});var n=a(7294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function r(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var s=n.createContext({}),p=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},u=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,o=e.mdxType,l=e.originalType,s=e.parentName,u=r(e,["components","mdxType","originalType","parentName"]),m=p(a),d=o,h=m["".concat(s,".").concat(d)]||m[d]||c[d]||l;return a?n.createElement(h,i(i({ref:t},u),{},{components:a})):n.createElement(h,i({ref:t},u))}));function d(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var l=a.length,i=new Array(l);i[0]=m;var r={};for(var s in t)hasOwnProperty.call(t,s)&&(r[s]=t[s]);r.originalType=e,r.mdxType="string"==typeof e?e:o,i[1]=r;for(var p=2;p<l;p++)i[p]=a[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},8923:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>u,contentTitle:()=>s,default:()=>d,frontMatter:()=>r,metadata:()=>p,toc:()=>c});var n=a(7462),o=a(3366),l=(a(7294),a(3905)),i=["components"],r={id:"deploy-matlab",title:"Matlab"},s=void 0,p={unversionedId:"deploy-matlab",id:"deploy-matlab",title:"Matlab",description:"Note that we are not expert in Matlab: feel free to contact Mathworks support directly if you are having any issues with their official Docker image. Because since it's closed source we cannot fix it ourselves.",source:"@site/docs/deploy-matlab.md",sourceDirName:".",slug:"/deploy-matlab",permalink:"/docs/deploy-matlab",editUrl:"https://github.com/MaastrichtU-IDS/dsri-documentation/edit/master/website/docs/deploy-matlab.md",tags:[],version:"current",lastUpdatedBy:"Vincent Emonet",lastUpdatedAt:1663166418,formattedLastUpdatedAt:"9/14/2022",frontMatter:{id:"deploy-matlab",title:"Matlab"},sidebar:"docs",previous:{title:"Databases",permalink:"/docs/deploy-database"},next:{title:"JupyterHub",permalink:"/docs/deploy-jupyterhub"}},u={},c=[{value:"Use the official Matlab image",id:"use-the-official-matlab-image",level:2},{value:"Use a stable Matlab image",id:"use-a-stable-matlab-image",level:2},{value:"Use Matlab in Jupyter",id:"use-matlab-in-jupyter",level:2},{value:"Deploy Matlab on GPU",id:"deploy-matlab-on-gpu",level:2},{value:"Build your own Matlab image",id:"build-your-own-matlab-image",level:2}],m={toc:c};function d(e){var t=e.components,a=(0,o.Z)(e,i);return(0,l.kt)("wrapper",(0,n.Z)({},m,a,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("p",null,"Note that we are not expert in Matlab: feel free to contact Mathworks support directly if you are having any issues with their official Docker image. Because since it's closed source we cannot fix it ourselves."),(0,l.kt)("p",null,"You can request official support from Matlab at this address after login and connecting your account to the UM license: ",(0,l.kt)("a",{parentName:"p",href:"https://nl.mathworks.com/academia/tah-portal/maastricht-university-31574866.html#get"},"https://nl.mathworks.com/academia/tah-portal/maastricht-university-31574866.html#get")),(0,l.kt)("h2",{id:"use-the-official-matlab-image"},"Use the official Matlab image"),(0,l.kt)("p",null,"Start Matlab with a desktop UI accessible directly using your web browser at a URL automatically generated. "),(0,l.kt)("p",null,"Go to the ",(0,l.kt)("strong",{parentName:"p"},"Catalog"),", make sure ",(0,l.kt)("strong",{parentName:"p"},"Templates")," are displayed (box checked), and search for ",(0,l.kt)("strong",{parentName:"p"},"Matlab"),", and provide the right parameters:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"You will need to provide the password you will use to access the Matlab UI when filling the template."),(0,l.kt)("li",{parentName:"ul"},"You can also change the Matlab image version, see the latest version released in the ",(0,l.kt)("a",{parentName:"li",href:"https://hub.docker.com/r/mathworks/matlab"},"official Matlab Docker image documentation"))),(0,l.kt)("p",null,"Once Matlab start you can access it through 2 routes (URL), which can be accessed when clicking on the Matlab node in the ",(0,l.kt)("strong",{parentName:"p"},"Topology"),":"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"The main ",(0,l.kt)("inlineCode",{parentName:"li"},"matlab")," route to access Matlab desktop UI directly in your web browser. It is recommended to use this route."),(0,l.kt)("li",{parentName:"ul"},"The ",(0,l.kt)("inlineCode",{parentName:"li"},"matlab-vnc")," route can be used to access Matlab using a VNC client (you will need to use the full URL to your Matlab VNC route). Only use it if you know what you're doing.")),(0,l.kt)("h2",{id:"use-a-stable-matlab-image"},"Use a stable Matlab image"),(0,l.kt)("p",null,"The official Matlab image is infamous for showing a black screening after a few hours of use, making it a bit cumbersome to be used trustfully."),(0,l.kt)("p",null,"We have a solution if you need to have a more stable Matlab image, that will require a bit more manual operations:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Use the ",(0,l.kt)("strong",{parentName:"li"},"Ubuntu with GUI")," template to setup a Ubuntu pod on the DSRI with the image ",(0,l.kt)("a",{parentName:"li",href:"https://github.com/vemonet/docker-ubuntu-vnc-desktop"},(0,l.kt)("inlineCode",{parentName:"a"},"ghcr.io/vemonet/docker-ubuntu-vnc-desktop:latest"))),(0,l.kt)("li",{parentName:"ul"},"Start firefox and browse to ",(0,l.kt)("a",{parentName:"li",href:"https://nl.mathworks.com"},"https://nl.mathworks.com")),(0,l.kt)("li",{parentName:"ul"},"Login with your personal Matlab account, create one if you don\u2019t have it"),(0,l.kt)("li",{parentName:"ul"},"Choose ",(0,l.kt)("strong",{parentName:"li"},"get matlab")," and download, the linux matlab version"),(0,l.kt)("li",{parentName:"ul"},"Open a terminal window and run the following commands:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"sudo apt-get update\nsudo apt-get install unzip\n# Unzip the previous downloaded matlab installation file\n# start the matlab installation with:\nsudo .\\install\n")),(0,l.kt)("p",null,"You will then be prompted the Matlab installation process:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Fill in your personal matlab account credentials"),(0,l.kt)("li",{parentName:"ul"},"\u26a0\ufe0f Fill in the username as used in the Ubuntu environment, in your case it will most probably be ",(0,l.kt)("strong",{parentName:"li"},"root"),"  (Matlab gives a license error if this is not correct, check with ",(0,l.kt)("inlineCode",{parentName:"li"},"whoami")," in the terminal when in doubt)"),(0,l.kt)("li",{parentName:"ul"},"Select every Matlab modules you want to be installed"),(0,l.kt)("li",{parentName:"ul"},'Check "symbolic link" and "Improve\u2026\u2026"')),(0,l.kt)("h2",{id:"use-matlab-in-jupyter"},"Use Matlab in Jupyter"),(0,l.kt)("p",null,"You can also use ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/mathworks/jupyter-matlab-proxy"},"mathworks/jupyter-matlab-proxy"),". You can easily install it in a JupyterLab image with ",(0,l.kt)("inlineCode",{parentName:"p"},"pip"),":"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"pip install jupyter-matlab-proxy\n")),(0,l.kt)("p",null,"Follow the instructions on the ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/mathworks/jupyter-matlab-proxy"},"mathworks/jupyter-matlab-proxy repository")," to access it."),(0,l.kt)("h2",{id:"deploy-matlab-on-gpu"},"Deploy Matlab on GPU"),(0,l.kt)("p",null,"We use the Matlab template in the DSRI catalog to deploy a pre-built ",(0,l.kt)("strong",{parentName:"p"},"Nvidia Matlab Deep Learning Container")," on CPU or GPU nodes. See the ",(0,l.kt)("a",{parentName:"p",href:"https://nl.mathworks.com/help/cloudcenter/ug/matlab-deep-learning-container-on-dgx.html"},"official documentation from MathWorks")," for more details about this image."),(0,l.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"Request access to Matlab")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"To be able to access the Matlab on GPU template you will need to ",(0,l.kt)("a",{parentName:"p",href:"/help"},"ask the DSRI admins")," to enable it in your project."))),(0,l.kt)("p",null,"2 options are available to connect to your running Matlab pod terminal:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Go to the matlab pod page on the DSRI web UI "),(0,l.kt)("li",{parentName:"ul"},"Or connect from your terminal with ",(0,l.kt)("inlineCode",{parentName:"li"},"oc rsh MATLAB_POD_ID"))),(0,l.kt)("p",null,"Type ",(0,l.kt)("inlineCode",{parentName:"p"},"bash")," when first accessing to the terminal to have a better experience."),(0,l.kt)("p",null,"Type ",(0,l.kt)("inlineCode",{parentName:"p"},"cd /ContainerDeepLearningData")," to go in the persistent volume, and use this volume to store all data that should be preserved."),(0,l.kt)("p",null,"Type ",(0,l.kt)("inlineCode",{parentName:"p"},"matlab")," to access Matlab from the terminal"),(0,l.kt)("p",null,"It is possible to access the Matlab desktop UI through VNC and a web UI, but the script to start it in ",(0,l.kt)("inlineCode",{parentName:"p"},"/bin/run.sh")," seems to face some errors, let us know if you have any luck with this."),(0,l.kt)("p",null,"By default the image run with the ",(0,l.kt)("inlineCode",{parentName:"p"},"matlab")," user which does not have ",(0,l.kt)("inlineCode",{parentName:"p"},"sudo")," privilege, you can run the container as root if you need to install packages which require admin privileges. "),(0,l.kt)("h2",{id:"build-your-own-matlab-image"},"Build your own Matlab image"),(0,l.kt)("p",null,"Follow the instructions at: ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/mathworks-ref-arch/matlab-dockerfile"},"https://github.com/mathworks-ref-arch/matlab-dockerfile")),(0,l.kt)("p",null,"This will require you to retrieve Matlab installation files to build your own container"),(0,l.kt)("p",null,"Once all the files have been properly placed in the folder and the license server URL has been set, you can start the build on DSRI by following the ",(0,l.kt)("a",{parentName:"p",href:"https://maastrichtu-ids.github.io/dsri-documentation/docs/guide-dockerfile-to-openshift#create-new-build-configuration"},"documentation to deploy from a ",(0,l.kt)("inlineCode",{parentName:"a"},"Dockerfile"))),(0,l.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"License server not available on your laptop")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"If you try to build Matlab directly on your laptop it will most probably fail as your machine might not have access to the license server. You will need to build the Matlab container directly on DSRI with ",(0,l.kt)("inlineCode",{parentName:"p"},"oc start-build")))),(0,l.kt)("p",null,"Once Matlab deployed, you will need to edit the matlab deployment YAML before it works."),(0,l.kt)("p",null,"Go to ",(0,l.kt)("strong",{parentName:"p"},"Topology"),", click on the Matlab node, click on the ",(0,l.kt)("strong",{parentName:"p"},"Actions")," button of the matlab details, and ",(0,l.kt)("strong",{parentName:"p"},"Edit deployment"),". In the deployment YAML search for ",(0,l.kt)("inlineCode",{parentName:"p"},"spec:")," which has a ",(0,l.kt)("inlineCode",{parentName:"p"},"containers:")," as child, and add the following under ",(0,l.kt)("inlineCode",{parentName:"p"},"spec:")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"spec:\n  serviceAccountName: anyuid\n  containers: ...\n")),(0,l.kt)("p",null,"Your Matlab container should now be running!"),(0,l.kt)("p",null,"2 options are available to connect to your running Matlab pod terminal:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Go to the matlab pod page on the DSRI web UI "),(0,l.kt)("li",{parentName:"ul"},"Or connect from your terminal with ",(0,l.kt)("inlineCode",{parentName:"li"},"oc rsh MATLAB_POD_ID"))),(0,l.kt)("p",null,"You can access Matlab from the terminal by running ",(0,l.kt)("inlineCode",{parentName:"p"},"matlab")),(0,l.kt)("p",null,"Unfortunately Matlab did not expected their users to need the graphical UI when using Matlab in containers. So only the command line is available by default. You can find more information to ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/mathworks-ref-arch/matlab-dockerfile/issues/18"},"enable the Matlab UI in this issue"),"."))}d.isMDXComponent=!0}}]);