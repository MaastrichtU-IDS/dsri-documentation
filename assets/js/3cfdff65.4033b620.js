"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[4242],{3905:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>g});var i=a(7294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function n(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,i,o=function(e,t){if(null==e)return{};var a,i,o={},r=Object.keys(e);for(i=0;i<r.length;i++)a=r[i],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)a=r[i],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var s=i.createContext({}),u=function(e){var t=i.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):n(n({},t),e)),a},p=function(e){var t=u(e.components);return i.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},m=i.forwardRef((function(e,t){var a=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),m=u(a),g=o,h=m["".concat(s,".").concat(g)]||m[g]||c[g]||r;return a?i.createElement(h,n(n({ref:t},p),{},{components:a})):i.createElement(h,n({ref:t},p))}));function g(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=a.length,n=new Array(r);n[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,n[1]=l;for(var u=2;u<r;u++)n[u]=a[u];return i.createElement.apply(null,n)}return i.createElement.apply(null,a)}m.displayName="MDXCreateElement"},5500:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>p,contentTitle:()=>s,default:()=>g,frontMatter:()=>l,metadata:()=>u,toc:()=>c});var i=a(3117),o=a(102),r=(a(7294),a(3905)),n=["components"],l={id:"guide-publish-image",title:"Publish a Docker image"},s=void 0,u={unversionedId:"guide-publish-image",id:"guide-publish-image",title:"Publish a Docker image",description:"\u26a0\ufe0f DockerHub imposes strict pull limitations for clusters like the DSRI (using DockerHub might result in failing to pull your images on the DSRI).",source:"@site/docs/guide-publish-image.md",sourceDirName:".",slug:"/guide-publish-image",permalink:"/docs/guide-publish-image",draft:!1,editUrl:"https://github.com/MaastrichtU-IDS/dsri-documentation/edit/master/website/docs/guide-publish-image.md",tags:[],version:"current",lastUpdatedBy:"Brouwers, Marcel (ICTS)",lastUpdatedAt:1698044544,formattedLastUpdatedAt:"Oct 23, 2023",frontMatter:{id:"guide-publish-image",title:"Publish a Docker image"},sidebar:"docs",previous:{title:"Data storage",permalink:"/docs/openshift-storage"},next:{title:"Delete objects (advanced)",permalink:"/docs/openshift-delete-objects"}},p={},c=[{value:"Login to Container Registries \ud83d\udd11",id:"login-to-container-registries-",level:2},{value:"Login to GitHub Container Registry",id:"login-to-github-container-registry",level:3},{value:"Login to quay.io",id:"login-to-quayio",level:3},{value:"Login to DockerHub",id:"login-to-dockerhub",level:3},{value:"Publish your image \ud83d\udce2",id:"publish-your-image-",level:2},{value:"Publish to GitHub Container Registry",id:"publish-to-github-container-registry",level:3},{value:"Publish to Quay.io",id:"publish-to-quayio",level:3},{value:"Publish to DockerHub",id:"publish-to-dockerhub",level:3},{value:"Use automated workflows",id:"use-automated-workflows",level:3}],m={toc:c};function g(e){var t=e.components,a=(0,o.Z)(e,n);return(0,r.kt)("wrapper",(0,i.Z)({},m,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("admonition",{title:"DockerHub pull rates limitations",type:"warning"},(0,r.kt)("p",{parentName:"admonition"},"\u26a0\ufe0f ",(0,r.kt)("strong",{parentName:"p"},"DockerHub imposes strict pull limitations for clusters")," like the DSRI (using DockerHub might result in failing to pull your images on the DSRI). "),(0,r.kt)("p",{parentName:"admonition"},"We highly recommend to ",(0,r.kt)("strong",{parentName:"p"},"use the ",(0,r.kt)("a",{parentName:"strong",href:"https://docs.github.com/en/free-pro-team@latest/packages/getting-started-with-github-container-registry/about-github-container-registry"},"GitHub Container Registry")," or ",(0,r.kt)("a",{parentName:"strong",href:"https://quay.io/"},"RedHat quay.io Container Registry")," to publish public Docker images"),".")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"You can also login to DockerHub using a Secret in OpenShift to increase the pull rates limitations from 100 to 200 every 6 hours (this will mitigate the issue, but not solve it completely if you do not have a paid account on DockerHub):"),(0,r.kt)("pre",{parentName:"blockquote"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"oc create secret docker-registry docker-hub-secret --docker-server=docker.io --docker-username=your-dockerhub-username --docker-password=your-dockerhub-password --docker-email=your-dockerhub-email\n"))),(0,r.kt)("h2",{id:"login-to-container-registries-"},"Login to Container Registries \ud83d\udd11"),(0,r.kt)("h3",{id:"login-to-github-container-registry"},"Login to GitHub Container Registry"),(0,r.kt)("p",null,"Use your existing ",(0,r.kt)("a",{parentName:"p",href:"https://github.com"},"GitHub")," account if you have one:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Create a ",(0,r.kt)("strong",{parentName:"li"},"Personal Access Token")," for GitHub packages at ",(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("a",{parentName:"strong",href:"https://github.com/settings/tokens/new"},"https://github.com/settings/tokens/new"))),(0,r.kt)("li",{parentName:"ol"},"Provide a meaningful description for the token, and enable the following scopes when creating the token:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"write:packages"),": publish container images to GitHub Container Registry"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"delete:packages"),": delete specified versions of private or public container images from GitHub Container Registry"))),(0,r.kt)("li",{parentName:"ol"},"You might want to store this token in a safe place, as you will not be able to retrieve it later on github.com (you can still delete it, and create a new token easily if you lose your token)"),(0,r.kt)("li",{parentName:"ol"},"\ud83d\udc68\u200d\ud83d\udcbb Log in to the GitHub Container Registry in your terminal (change ",(0,r.kt)("inlineCode",{parentName:"li"},"USERNAME")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"ACCESS_TOKEN")," to yours):")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'echo "ACCESS_TOKEN" | docker login ghcr.io -u USERNAME --password-stdin\n')),(0,r.kt)("p",null,"On Windows use this command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'docker login ghcr.io -u USERNAME -p "ACCESS_TOKEN"\n')),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"See the ",(0,r.kt)("a",{parentName:"p",href:"https://docs.github.com/en/free-pro-team@latest/packages/using-github-packages-with-your-projects-ecosystem/configuring-docker-for-use-with-github-packages"},"official GitHub documentation"),".")),(0,r.kt)("h3",{id:"login-to-quayio"},"Login to quay.io"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Create an account at ",(0,r.kt)("a",{parentName:"li",href:"https://quay.io"},"https://quay.io")," "),(0,r.kt)("li",{parentName:"ol"},"Login in your terminal (you will be asked for username and password)")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker login quay.io\n")),(0,r.kt)("h3",{id:"login-to-dockerhub"},"Login to DockerHub"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Get a ",(0,r.kt)("a",{parentName:"p",href:"https://hub.docker.com/"},"DockerHub")," account at ",(0,r.kt)("a",{parentName:"p",href:"https://hub.docker.com"},"https://hub.docker.com")," (you most probably already have one if you installed Docker Desktop)")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\ud83d\udc69\u200d\ud83d\udcbb Run in your terminal:"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker login\n")),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"Provide your DockerHub username and password.")),(0,r.kt)("h2",{id:"publish-your-image-"},"Publish your image \ud83d\udce2"),(0,r.kt)("p",null,"Once you built a Docker image, and you logged in to a Container Registry, you might want to publish the image to pull and re-use it easily later."),(0,r.kt)("h3",{id:"publish-to-github-container-registry"},"Publish to GitHub Container Registry"),(0,r.kt)("admonition",{title:"Free for public images",type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"The ",(0,r.kt)("a",{parentName:"p",href:"https://docs.github.com/en/free-pro-team@latest/packages/getting-started-with-github-container-registry"},"GitHub Container Registry")," is still in beta but will be free for public images when fully released. It enables you to store your Docker images at the same place you keep your code! \ud83d\udce6")),(0,r.kt)("p",null,"Publish to your user Container Registry on GitHub:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker build -t ghcr.io/github-username/my-image:latest .\ndocker push ghcr.io/github-username/my-image:latest\n")),(0,r.kt)("p",null,"For example, to the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/orgs/MaastrichtU-IDS/packages"},"MaastrichtU-IDS organization Container Registry on GitHub"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker build -t ghcr.io/maastrichtu-ids/jupyterlab:latest .\ndocker push ghcr.io/maastrichtu-ids/jupyterlab:latest\n")),(0,r.kt)("admonition",{title:"Created automatically",type:"info"},(0,r.kt)("p",{parentName:"admonition"},"If the image does not exist, GitHub Container Registry will create it automatically and set it as ",(0,r.kt)("strong",{parentName:"p"},"Private")," by default. You can easily change it to ",(0,r.kt)("strong",{parentName:"p"},"Public")," in the image settings on github.com.")),(0,r.kt)("h3",{id:"publish-to-quayio"},"Publish to Quay.io"),(0,r.kt)("admonition",{title:"Free for public images",type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"Quay.io is free for public images and does not restrict images pulls.")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Create the image on ",(0,r.kt)("a",{parentName:"p",href:"https://quay.io/"},"quay.io"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Build and push to ",(0,r.kt)("a",{parentName:"p",href:"https://quay.io/"},"quay.io")))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker build -t ghcr.io/quay-username/my-image:latest .\ndocker push quay.io/quay-username/my-image:latest\n")),(0,r.kt)("h3",{id:"publish-to-dockerhub"},"Publish to DockerHub"),(0,r.kt)("admonition",{title:"DockerHub pull rates limitations",type:"warning"},(0,r.kt)("p",{parentName:"admonition"},"\u26a0\ufe0f ",(0,r.kt)("strong",{parentName:"p"},"DockerHub imposes strict pull limitations for clusters")," like the DSRI (using DockerHub might result in failing to pull your images on the DSRI). "),(0,r.kt)("p",{parentName:"admonition"},"We highly recommend to ",(0,r.kt)("strong",{parentName:"p"},"use the ",(0,r.kt)("a",{parentName:"strong",href:"https://docs.github.com/en/free-pro-team@latest/packages/getting-started-with-github-container-registry/about-github-container-registry"},"GitHub Container Registry")," or ",(0,r.kt)("a",{parentName:"strong",href:"https://quay.io/"},"RedHat quay.io Container Registry")," to publish public Docker images"),".")),(0,r.kt)("admonition",{title:"Logged in",type:"info"},(0,r.kt)("p",{parentName:"admonition"},"If you are login with your DockerHub user on the DSRI, it should allow you to pull DockerHub images in your project (see above).")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Create the repository on ",(0,r.kt)("a",{parentName:"li",href:"https://hub.docker.com/"},"DockerHub")," (attached to your user or an ",(0,r.kt)("a",{parentName:"li",href:"https://hub.docker.com/orgs/umids/repositories"},"organization"),")"),(0,r.kt)("li",{parentName:"ol"},"Build and push the image:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker build -t dockerhub-username/jupyterlab:latest .\ndocker push dockerhub-username/jupyterlab:latest\n")),(0,r.kt)("p",null,"You can also change the name (aka. tag) of an existing image:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"docker build -t my-jupyterlab .\ndocker tag my-jupyterlab ghcr.io/github-username/jupyterlab:latest\n")),(0,r.kt)("h3",{id:"use-automated-workflows"},"Use automated workflows"),(0,r.kt)("p",null,"You can automate the building and publication of Docker images using GitHub Actions workflows \ud83d\udd04"),(0,r.kt)("admonition",{title:"Use a working workflow as example",type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"\ud83d\udc40 Check the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/MaastrichtU-IDS/get-started-with-docker/blob/main/.github/workflows/publish-docker.yml"},".github/workflows/publish-docker.yml file")," to see an example of a workflow to publish an image to the GitHub Container Registry.")),(0,r.kt)("p",null,"\ud83d\udc69\u200d\ud83d\udcbb You only need to change the ",(0,r.kt)("inlineCode",{parentName:"p"},"IMAGE_NAME"),", and use it in your GitHub repository to publish a Docker image for your application automatically! It will build from a ",(0,r.kt)("inlineCode",{parentName:"p"},"Dockerfile")," at the root of the repository."),(0,r.kt)("admonition",{title:"Workflow triggers",type:"info"},(0,r.kt)("p",{parentName:"admonition"},"The workflow can be easily configured to:"),(0,r.kt)("ul",{parentName:"admonition"},(0,r.kt)("li",{parentName:"ul"},"publish a new image to the ",(0,r.kt)("inlineCode",{parentName:"li"},"latest")," tag at each push to the main branch"),(0,r.kt)("li",{parentName:"ul"},"publish an image to a new tag if a release is pushed on GitHub (using the git tag)",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"e.g. ",(0,r.kt)("inlineCode",{parentName:"li"},"v0.0.1")," published as image ",(0,r.kt)("inlineCode",{parentName:"li"},"0.0.1")))))))}g.isMDXComponent=!0}}]);