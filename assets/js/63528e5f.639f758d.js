"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[3694],{3905:(e,t,n)=>{n.d(t,{Zo:()=>s,kt:()=>m});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var c=a.createContext({}),p=function(e){var t=a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},s=function(e){var t=p(e.components);return a.createElement(c.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,c=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),u=p(n),m=o,k=u["".concat(c,".").concat(m)]||u[m]||d[m]||i;return n?a.createElement(k,r(r({ref:t},s),{},{components:n})):a.createElement(k,r({ref:t},s))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,r=new Array(i);r[0]=u;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l.mdxType="string"==typeof e?e:o,r[1]=l;for(var p=2;p<i;p++)r[p]=n[p];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},1651:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>c,default:()=>m,frontMatter:()=>l,metadata:()=>p,toc:()=>d});var a=n(3117),o=n(102),i=(n(7294),n(3905)),r=["components"],l={id:"openshift-delete-objects",title:"Delete objects (advanced)"},c=void 0,p={unversionedId:"openshift-delete-objects",id:"openshift-delete-objects",title:"Delete objects (advanced)",description:"This documentation provide guidelines to delete various types of objects in the OpenShift DSRI. Be careful when you are deleting object in your project, as it could be an object required to run an application.",source:"@site/docs/openshift-delete-objects.md",sourceDirName:".",slug:"/openshift-delete-objects",permalink:"/docs/openshift-delete-objects",draft:!1,editUrl:"https://github.com/MaastrichtU-IDS/dsri-documentation/edit/master/website/docs/openshift-delete-objects.md",tags:[],version:"current",lastUpdatedBy:"Vincent Emonet",lastUpdatedAt:1676543637,formattedLastUpdatedAt:"Feb 16, 2023",frontMatter:{id:"openshift-delete-objects",title:"Delete objects (advanced)"},sidebar:"docs",previous:{title:"Publish a Docker image",permalink:"/docs/guide-publish-image"},next:{title:"Libraries for Machine Learning",permalink:"/docs/tools-machine-learning"}},s={},d=[{value:"Delete an application",id:"delete-an-application",level:2},{value:"Delete pod",id:"delete-pod",level:2},{value:"Delete a project",id:"delete-a-project",level:2},{value:"Delete persistent storage",id:"delete-persistent-storage",level:2},{value:"Fix stuck deletions",id:"fix-stuck-deletions",level:2},{value:"Stuck provisioned service",id:"stuck-provisioned-service",level:3},{value:"Delete stuck project",id:"delete-stuck-project",level:3}],u={toc:d};function m(e){var t=e.components,n=(0,o.Z)(e,r);return(0,i.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("admonition",{title:"Be careful",type:"warning"},(0,i.kt)("p",{parentName:"admonition"},"This documentation provide guidelines to delete various types of objects in the OpenShift DSRI. Be careful when you are deleting object in your project, as it could be an object required to run an application.")),(0,i.kt)("p",null,"It is recommend to use the ",(0,i.kt)("inlineCode",{parentName:"p"},"oc")," tool to delete OpenShift objects, as it will allow to properly delete all objects related to specific deployments."),(0,i.kt)("admonition",{title:"Project",type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"Make sure you are connected to the right project:"),(0,i.kt)("pre",{parentName:"admonition"},(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"oc project my-project\n"))),(0,i.kt)("h2",{id:"delete-an-application"},"Delete an application"),(0,i.kt)("p",null,"The best way to make sure all objects related to your application have been deleted is to use the command line providing your application name."),(0,i.kt)("p",null,"Different selectors can be used to easily delete all objects generated by an application deployment. 2 selectors can easily be found in the template configuration:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"app")," : the name you gave when creating your application"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"template")," : the name of the template you used to create the application. Use it only if you want to delete all applications created by a specific template.")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"oc delete all,secret,configmaps,serviceaccount,rolebinding --selector app=my-application\n")),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Delete storage if necessary from the OpenShift web UI.")),(0,i.kt)("admonition",{title:"Force deletion",type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"You can force the deletion if the objects are not deleting properly:"),(0,i.kt)("pre",{parentName:"admonition"},(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"oc delete all,secret,configmaps,serviceaccount,rolebinding --force --grace-period=0 --selector app=my-application\n"))),(0,i.kt)("h2",{id:"delete-pod"},"Delete pod"),(0,i.kt)("p",null,"Get the ID of the specific pod you want to delete:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"oc get pod\n")),(0,i.kt)("p",null,"Use the pod ID retrieved to delete the pod:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"oc delete pod <POD_ID>\n")),(0,i.kt)("admonition",{title:"Force deletion",type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"If the pod is not properly deleted, you can force its deletion:"),(0,i.kt)("pre",{parentName:"admonition"},(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"oc delete pod --force --grace-period=0 <POD_ID>\n"))),(0,i.kt)("h2",{id:"delete-a-project"},"Delete a project"),(0,i.kt)("admonition",{title:"Be careful",type:"warning"},(0,i.kt)("p",{parentName:"admonition"},"All objects and persistent storages in this project will be deleted and cannot be retrieved.")),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"To properly delete a project you need to first delete all objects in this project:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"oc delete all,configmap,pvc,serviceaccount,rolebinding,secret,serviceinstance --all -n <PROJECT_ID>\n")),(0,i.kt)("ol",{start:2},(0,i.kt)("li",{parentName:"ol"},"Then delete the project:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"oc delete project <PROJECT_ID>\n")),(0,i.kt)("h2",{id:"delete-persistent-storage"},"Delete persistent storage"),(0,i.kt)("admonition",{title:"Be careful",type:"warning"},(0,i.kt)("p",{parentName:"admonition"},"All data stored in this persistent storage will be lost and cannot be retrieved.")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"oc delete pvc storage-name\n")),(0,i.kt)("h2",{id:"fix-stuck-deletions"},"Fix stuck deletions"),(0,i.kt)("h3",{id:"stuck-provisioned-service"},"Stuck provisioned service"),(0,i.kt)("p",null,"If a provisioned service is stuck on ",(0,i.kt)("inlineCode",{parentName:"p"},"Marked for deletion")," you might need to set finalizers to null in the YAML."),(0,i.kt)("p",null,"This can be done using the OpenShift web UI:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Go to the ",(0,i.kt)("strong",{parentName:"p"},"Provisionned Service")," in the OpenShift UI overview")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Click on ",(0,i.kt)("strong",{parentName:"p"},"Edit YAML"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Remove the ",(0,i.kt)("strong",{parentName:"p"},"finalizers"),":"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"  finalizers:\n    - kubernetes-incubator/service-catalog\n")))),(0,i.kt)("p",null,"You can also do it using the ",(0,i.kt)("inlineCode",{parentName:"p"},"oc")," CLI:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},'oc get serviceinstance\n \n# Delete problematic line from serviceinstance to delete them\noc get serviceinstance -o yaml | grep Terminating | sed "/kubernetes-incubator/d"| oc apply -f - \n')),(0,i.kt)("admonition",{title:"No global catalog",type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"The OpenShift Catalog does not handle deploying templates globally properly (on all projects). If a template is deployed globally, OpenShift will try to create unnecessary objects such as provisioned service (aka. ServiceInstance), or ClusterClasses. Those services are not used, and some of them cannot be deleted easily. ")),(0,i.kt)("admonition",{title:"Catalog per project ",type:"info"},(0,i.kt)("p",{parentName:"admonition"},"At the moment it is more reliable to create the template in directly in your project if you need to use it multiple time.")),(0,i.kt)("h3",{id:"delete-stuck-project"},"Delete stuck project"),(0,i.kt)("p",null,"Project can get stuck as marked for deletion. Usually due to Objects still present in the project that are not terminated or ",(0,i.kt)("inlineCode",{parentName:"p"},"finalizers")," left in the some objects YAML file."),(0,i.kt)("p",null,"The following commands will allow you to clean up all the projects stuck in terminating state you have access to ."),(0,i.kt)("p",null,"Force deletion of terminating projects:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"for i in $(oc get projects  | grep Terminating| awk '{print $1}'); do echo $i; oc delete project --force --grace-period=0 $i ; done\n")),(0,i.kt)("p",null,"Delete all objects in terminating projects:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"for i in $(oc get projects  | grep Terminating| awk '{print $1}'); do echo $i; oc delete all,configmap,pvc,serviceaccount,rolebinding,secret,serviceinstance --force --grace-period=0 --all -n $i ; done\n")),(0,i.kt)("p",null,"Remove Kubernetes finalizers from terminating projects:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'for i in $(oc get projects  | grep Terminating| awk \'{print $1}\'); do echo $i; oc get project $i -o yaml | sed "/kubernetes/d" | sed "/finalizers:/d" | oc apply -f - ; done\n')),(0,i.kt)("admonition",{title:"Fix deletion",type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"If ",(0,i.kt)("inlineCode",{parentName:"p"},"ServiceInstances")," refuses to get deleted, try to remove kubernetes finalizers:"),(0,i.kt)("pre",{parentName:"admonition"},(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"for i in $(oc get projects  | grep Terminating| awk '{print $1}'); do echo $i; oc get serviceinstance -n $i -o yaml | sed \"/kubernetes-incubator/d\"| oc apply -f - ; done\n"))),(0,i.kt)("admonition",{title:"Check deletion",type:"info"},(0,i.kt)("p",{parentName:"admonition"},"Check if there are still objects in a project:"),(0,i.kt)("pre",{parentName:"admonition"},(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"oc get all,configmap,pvc,serviceaccount,secret,rolebinding,serviceinstance\n"))))}m.isMDXComponent=!0}}]);