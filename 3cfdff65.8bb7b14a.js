(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{127:function(e,t,a){"use strict";a.d(t,"a",(function(){return u})),a.d(t,"b",(function(){return d}));var i=a(0),o=a.n(i);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function c(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function b(e,t){if(null==e)return{};var a,i,o=function(e,t){if(null==e)return{};var a,i,o={},n=Object.keys(e);for(i=0;i<n.length;i++)a=n[i],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(i=0;i<n.length;i++)a=n[i],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var l=o.a.createContext({}),s=function(e){var t=o.a.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):c(c({},t),e)),a},u=function(e){var t=s(e.components);return o.a.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return o.a.createElement(o.a.Fragment,{},t)}},m=o.a.forwardRef((function(e,t){var a=e.components,i=e.mdxType,n=e.originalType,r=e.parentName,l=b(e,["components","mdxType","originalType","parentName"]),u=s(a),m=i,d=u["".concat(r,".").concat(m)]||u[m]||p[m]||n;return a?o.a.createElement(d,c(c({ref:t},l),{},{components:a})):o.a.createElement(d,c({ref:t},l))}));function d(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var n=a.length,r=new Array(n);r[0]=m;var c={};for(var b in t)hasOwnProperty.call(t,b)&&(c[b]=t[b]);c.originalType=e,c.mdxType="string"==typeof e?e:i,r[1]=c;for(var l=2;l<n;l++)r[l]=a[l];return o.a.createElement.apply(null,r)}return o.a.createElement.apply(null,a)}m.displayName="MDXCreateElement"},85:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return r})),a.d(t,"metadata",(function(){return c})),a.d(t,"rightToc",(function(){return b})),a.d(t,"default",(function(){return s}));var i=a(3),o=a(7),n=(a(0),a(127)),r={id:"guide-publish-image",title:"Publish a Docker image"},c={unversionedId:"guide-publish-image",id:"guide-publish-image",isDocsHomePage:!1,title:"Publish a Docker image",description:"\u26a0\ufe0f DockerHub imposes strict pull limitations for clusters like the DSRI (using DockerHub might result in failing to pull your images on the DSRI).",source:"@site/docs/guide-publish-image.md",slug:"/guide-publish-image",permalink:"/dsri-documentation/docs/guide-publish-image",editUrl:"https://github.com/MaastrichtU-IDS/dsri-documentation/edit/master/website/docs/guide-publish-image.md",version:"current",lastUpdatedBy:"Vincent Emonet",lastUpdatedAt:1607077276,sidebar:"docs",previous:{title:"Prepare your project",permalink:"/dsri-documentation/docs/prepare-project-for-dsri"},next:{title:"Use secrets",permalink:"/dsri-documentation/docs/openshift-secret"}},b=[{value:"Login to Container Registries \ud83d\udd11",id:"login-to-container-registries-",children:[{value:"Login to GitHub Container Registry",id:"login-to-github-container-registry",children:[]},{value:"Login to quay.io",id:"login-to-quayio",children:[]},{value:"Login to DockerHub",id:"login-to-dockerhub",children:[]}]},{value:"Publish your image \ud83d\udce2",id:"publish-your-image-",children:[{value:"Publish to GitHub Container Registry",id:"publish-to-github-container-registry",children:[]},{value:"Publish to Quay.io",id:"publish-to-quayio",children:[]},{value:"Publish to DockerHub",id:"publish-to-dockerhub",children:[]},{value:"Use automated workflows",id:"use-automated-workflows",children:[]}]}],l={rightToc:b};function s(e){var t=e.components,a=Object(o.a)(e,["components"]);return Object(n.b)("wrapper",Object(i.a)({},l,a,{components:t,mdxType:"MDXLayout"}),Object(n.b)("div",{className:"admonition admonition-warning alert alert--danger"},Object(n.b)("div",Object(i.a)({parentName:"div"},{className:"admonition-heading"}),Object(n.b)("h5",{parentName:"div"},Object(n.b)("span",Object(i.a)({parentName:"h5"},{className:"admonition-icon"}),Object(n.b)("svg",Object(i.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"}),Object(n.b)("path",Object(i.a)({parentName:"svg"},{fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"})))),"warning")),Object(n.b)("div",Object(i.a)({parentName:"div"},{className:"admonition-content"}),Object(n.b)("p",{parentName:"div"},"\u26a0\ufe0f ",Object(n.b)("strong",{parentName:"p"},"DockerHub imposes strict pull limitations for clusters")," like the DSRI (using DockerHub might result in failing to pull your images on the DSRI). "),Object(n.b)("p",{parentName:"div"},"We highly recommend to ",Object(n.b)("strong",{parentName:"p"},"use the ",Object(n.b)("a",Object(i.a)({parentName:"strong"},{href:"https://docs.github.com/en/free-pro-team@latest/packages/getting-started-with-github-container-registry/about-github-container-registry"}),"GitHub Container Registry")," or ",Object(n.b)("a",Object(i.a)({parentName:"strong"},{href:"https://quay.io/"}),"RedHat quay.io Container Registry")," to publish public Docker images"),"."))),Object(n.b)("blockquote",null,Object(n.b)("p",{parentName:"blockquote"},"You can also login to DockerHub using a Secret in OpenShift to increase the pull rates limitations from 100 to 200 every 6 hours (this will mitigate the issue, but not solve it completely if you do not have a paid account on DockerHub):"),Object(n.b)("pre",{parentName:"blockquote"},Object(n.b)("code",Object(i.a)({parentName:"pre"},{className:"language-bash"}),"oc create secret docker-registry docker-hub-secret --docker-server=docker.io --docker-username=your-dockerhub-username --docker-password=your-dockerhub-password --docker-email=your-dockerhub-email\n"))),Object(n.b)("h2",{id:"login-to-container-registries-"},"Login to Container Registries \ud83d\udd11"),Object(n.b)("h3",{id:"login-to-github-container-registry"},"Login to GitHub Container Registry"),Object(n.b)("p",null,"Use your existing ",Object(n.b)("a",Object(i.a)({parentName:"p"},{href:"https://github.com"}),"GitHub")," account if you have one:"),Object(n.b)("ol",null,Object(n.b)("li",{parentName:"ol"},"Create a ",Object(n.b)("strong",{parentName:"li"},"Personal Access Token")," for GitHub packages at ",Object(n.b)("strong",{parentName:"li"},Object(n.b)("a",Object(i.a)({parentName:"strong"},{href:"https://github.com/settings/tokens/new"}),"https://github.com/settings/tokens/new"))),Object(n.b)("li",{parentName:"ol"},"Provide a meaningful description for the token, and enable the following scopes when creating the token:",Object(n.b)("ul",{parentName:"li"},Object(n.b)("li",{parentName:"ul"},Object(n.b)("inlineCode",{parentName:"li"},"write:packages"),": publish container images to GitHub Container Registry"),Object(n.b)("li",{parentName:"ul"},Object(n.b)("inlineCode",{parentName:"li"},"delete:packages"),": delete specified versions of private or public container images from GitHub Container Registry"))),Object(n.b)("li",{parentName:"ol"},"You might want to store this token in a safe place, as you will not be able to retrieve it later on github.com (you can still delete it, and create a new token easily if you lose your token)"),Object(n.b)("li",{parentName:"ol"},"\ud83d\udc68\u200d\ud83d\udcbb Log in to the GitHub Container Registry in your terminal (change ",Object(n.b)("inlineCode",{parentName:"li"},"USERNAME")," and ",Object(n.b)("inlineCode",{parentName:"li"},"ACCESS_TOKEN")," to yours):")),Object(n.b)("pre",null,Object(n.b)("code",Object(i.a)({parentName:"pre"},{className:"language-bash"}),'echo "ACCESS_TOKEN" | docker login ghcr.io -u USERNAME --password-stdin\n')),Object(n.b)("blockquote",null,Object(n.b)("p",{parentName:"blockquote"},"See the ",Object(n.b)("a",Object(i.a)({parentName:"p"},{href:"https://docs.github.com/en/free-pro-team@latest/packages/using-github-packages-with-your-projects-ecosystem/configuring-docker-for-use-with-github-packages"}),"official GitHub documentation"),".")),Object(n.b)("h3",{id:"login-to-quayio"},"Login to quay.io"),Object(n.b)("ol",null,Object(n.b)("li",{parentName:"ol"},"Create an account at ",Object(n.b)("a",Object(i.a)({parentName:"li"},{href:"https://quay.io"}),"https://quay.io")," "),Object(n.b)("li",{parentName:"ol"},"Login in your terminal (you will be asked for username and password)")),Object(n.b)("pre",null,Object(n.b)("code",Object(i.a)({parentName:"pre"},{className:"language-bash"}),"docker login quay.io\n")),Object(n.b)("h3",{id:"login-to-dockerhub"},"Login to DockerHub"),Object(n.b)("ol",null,Object(n.b)("li",{parentName:"ol"},Object(n.b)("p",{parentName:"li"},"Get a ",Object(n.b)("a",Object(i.a)({parentName:"p"},{href:"https://hub.docker.com/"}),"DockerHub")," account at ",Object(n.b)("a",Object(i.a)({parentName:"p"},{href:"https://hub.docker.com"}),"https://hub.docker.com")," (you most probably already have one if you installed Docker Desktop)")),Object(n.b)("li",{parentName:"ol"},Object(n.b)("p",{parentName:"li"},"\ud83d\udc69\u200d\ud83d\udcbb Run in your terminal:"))),Object(n.b)("pre",null,Object(n.b)("code",Object(i.a)({parentName:"pre"},{className:"language-bash"}),"docker login\n")),Object(n.b)("ol",{start:3},Object(n.b)("li",{parentName:"ol"},"Provide your DockerHub username and password.")),Object(n.b)("h2",{id:"publish-your-image-"},"Publish your image \ud83d\udce2"),Object(n.b)("p",null,"Once you built a Docker image, and you logged in to a Container Registry, you might want to publish the image to pull and re-use it easily later."),Object(n.b)("h3",{id:"publish-to-github-container-registry"},"Publish to GitHub Container Registry"),Object(n.b)("p",null,"The ",Object(n.b)("a",Object(i.a)({parentName:"p"},{href:"https://docs.github.com/en/free-pro-team@latest/packages/getting-started-with-github-container-registry"}),"GitHub Container Registry")," is still in beta but will be free for public images when fully released. It enables you to store your Docker images at the same place you keep your code! \ud83d\udce6"),Object(n.b)("p",null,"Publish to your user Container Registry on GitHub:"),Object(n.b)("pre",null,Object(n.b)("code",Object(i.a)({parentName:"pre"},{className:"language-bash"}),"docker build -t ghcr.io/github-username/my-image:latest .\ndocker push ghcr.io/github-username/my-image:latest\n")),Object(n.b)("p",null,"For example, to the ",Object(n.b)("a",Object(i.a)({parentName:"p"},{href:"https://github.com/orgs/MaastrichtU-IDS/packages"}),"MaastrichtU-IDS organization Container Registry on GitHub"),":"),Object(n.b)("pre",null,Object(n.b)("code",Object(i.a)({parentName:"pre"},{className:"language-bash"}),"docker build -t ghcr.io/maastrichtu-ids/jupyterlab-on-openshift:latest .\ndocker push ghcr.io/maastrichtu-ids/jupyterlab-on-openshift:latest\n")),Object(n.b)("div",{className:"admonition admonition-info alert alert--info"},Object(n.b)("div",Object(i.a)({parentName:"div"},{className:"admonition-heading"}),Object(n.b)("h5",{parentName:"div"},Object(n.b)("span",Object(i.a)({parentName:"h5"},{className:"admonition-icon"}),Object(n.b)("svg",Object(i.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(n.b)("path",Object(i.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"info")),Object(n.b)("div",Object(i.a)({parentName:"div"},{className:"admonition-content"}),Object(n.b)("p",{parentName:"div"},"If the image does not exist, GitHub Container Registry will create it automatically and set it as ",Object(n.b)("strong",{parentName:"p"},"Private")," by default. You can easily change it to ",Object(n.b)("strong",{parentName:"p"},"Public")," in the image settings on github.com."))),Object(n.b)("h3",{id:"publish-to-quayio"},"Publish to Quay.io"),Object(n.b)("ol",null,Object(n.b)("li",{parentName:"ol"},Object(n.b)("p",{parentName:"li"},"Create the image on ",Object(n.b)("a",Object(i.a)({parentName:"p"},{href:"https://quay.io/"}),"quay.io"))),Object(n.b)("li",{parentName:"ol"},Object(n.b)("p",{parentName:"li"},"Build and push to ",Object(n.b)("a",Object(i.a)({parentName:"p"},{href:"https://quay.io/"}),"quay.io")))),Object(n.b)("pre",null,Object(n.b)("code",Object(i.a)({parentName:"pre"},{className:"language-bash"}),"docker build -t ghcr.io/quay-username/my-image:latest .\ndocker push quay.io/quay-username/my-image:latest\n")),Object(n.b)("h3",{id:"publish-to-dockerhub"},"Publish to DockerHub"),Object(n.b)("p",null,"It is not recommended, but ",Object(n.b)("a",Object(i.a)({parentName:"p"},{href:"https://hub.docker.com/"}),"DockerHub")," is still the most popular and mature Container Registry, if you are login to DockerHub on the DSRI it should allow you to pull DockerHub images in your project (see at the start of this page to do so)."),Object(n.b)("ol",null,Object(n.b)("li",{parentName:"ol"},"Create the repository on ",Object(n.b)("a",Object(i.a)({parentName:"li"},{href:"https://hub.docker.com/"}),"DockerHub")," (attached to your user or an ",Object(n.b)("a",Object(i.a)({parentName:"li"},{href:"https://hub.docker.com/orgs/umids/repositories"}),"organization"),")"),Object(n.b)("li",{parentName:"ol"},"Build and push the image:")),Object(n.b)("pre",null,Object(n.b)("code",Object(i.a)({parentName:"pre"},{className:"language-bash"}),"docker build -t dockerhub-username/jupyterlab:latest .\ndocker push dockerhub-username/jupyterlab:latest\n")),Object(n.b)("p",null,"You can also change the name (aka. tag) of an existing image:"),Object(n.b)("pre",null,Object(n.b)("code",Object(i.a)({parentName:"pre"},{className:"language-bash"}),"docker build -t my-jupyterlab .\ndocker tag my-jupyterlab ghcr.io/github-username/jupyterlab:latest\n")),Object(n.b)("h3",{id:"use-automated-workflows"},"Use automated workflows"),Object(n.b)("p",null,"You can automate the building and publication of Docker images using GitHub Actions workflows \ud83d\udd04"),Object(n.b)("p",null,"\ud83d\udc40 Check the ",Object(n.b)("a",Object(i.a)({parentName:"p"},{href:"https://github.com/MaastrichtU-IDS/get-started-with-docker/blob/main/.github/workflows/publish-docker.yml"}),Object(n.b)("inlineCode",{parentName:"a"},".github/workflows/publish-docker.yml")," file")," to see an example of a workflow to publish an image to the GitHub Container Registry."),Object(n.b)("p",null,"\ud83d\udc69\u200d\ud83d\udcbb You only need to change the ",Object(n.b)("inlineCode",{parentName:"p"},"IMAGE_NAME"),", and use it in your GitHub repository to publish a Docker image for your application automatically! It will build from a ",Object(n.b)("inlineCode",{parentName:"p"},"Dockerfile")," at the root of the repository."),Object(n.b)("p",null,"The workflow can be easily configured to:"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},"publish a new image to the ",Object(n.b)("inlineCode",{parentName:"li"},"latest")," tag at each push to the main branch"),Object(n.b)("li",{parentName:"ul"},"publish an image to a new tag if a release is pushed on GitHub (using the git tag)",Object(n.b)("ul",{parentName:"li"},Object(n.b)("li",{parentName:"ul"},"e.g. ",Object(n.b)("inlineCode",{parentName:"li"},"v0.0.1")," published as image ",Object(n.b)("inlineCode",{parentName:"li"},"0.0.1"))))),Object(n.b)("div",{className:"admonition admonition-info alert alert--info"},Object(n.b)("div",Object(i.a)({parentName:"div"},{className:"admonition-heading"}),Object(n.b)("h5",{parentName:"div"},Object(n.b)("span",Object(i.a)({parentName:"h5"},{className:"admonition-icon"}),Object(n.b)("svg",Object(i.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(n.b)("path",Object(i.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"info")),Object(n.b)("div",Object(i.a)({parentName:"div"},{className:"admonition-content"}),Object(n.b)("p",{parentName:"div"},"GitHub Actions is still currently evolving quickly, feel free to check if they recommend a new way to build and publish containers \ud83d\ude80"))))}s.isMDXComponent=!0}}]);