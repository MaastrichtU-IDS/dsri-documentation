<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.69">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:200,300,400,400i,500,600,700">
<link rel="stylesheet" href="/dsri-documentation/css/code-blocks-buttons.css">
<script src="https://buttons.github.io/buttons.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
<script src="/dsri-documentation/js/code-blocks-buttons.js"></script><title data-react-helmet="true">JupyterHub with Spark cluster | Data Science Research Infrastructure</title><meta data-react-helmet="true" property="og:image" content="https://dsri.maastrichtuniversity.nl//img/undraw_online.svg"><meta data-react-helmet="true" property="twitter:image" content="https://dsri.maastrichtuniversity.nl//img/undraw_online.svg"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for Data Science Research Infrastructure"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_language" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="JupyterHub with Spark cluster | Data Science Research Infrastructure"><meta data-react-helmet="true" name="description" content="JupyterHub is ideal to enable multiple users easily start predefined workspaces in the same project. The complimentary Apache Spark cluster can be used from the workspaces to perform distributed processing."><meta data-react-helmet="true" property="og:description" content="JupyterHub is ideal to enable multiple users easily start predefined workspaces in the same project. The complimentary Apache Spark cluster can be used from the workspaces to perform distributed processing."><meta data-react-helmet="true" property="og:url" content="https://dsri.maastrichtuniversity.nl//docs/jupyterhub-spark"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://dsri.maastrichtuniversity.nl//docs/jupyterhub-spark"><link rel="stylesheet" href="/styles.7279487c.css">
<link rel="preload" href="/styles.70887d1f.js" as="script">
<link rel="preload" href="/runtime~main.57c8563e.js" as="script">
<link rel="preload" href="/main.07e63e00.js" as="script">
<link rel="preload" href="/1.e90966bd.js" as="script">
<link rel="preload" href="/1f391b9e.f6253f77.js" as="script">
<link rel="preload" href="/81.99b39d61.js" as="script">
<link rel="preload" href="/935f2afb.b50e0861.js" as="script">
<link rel="preload" href="/79.9c645739.js" as="script">
<link rel="preload" href="/3a93ea81.bd3bc90e.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_2AhQ">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img src="/img/favicon.ico" alt="Data Science Research Infrastructure" class="themedImage_2E_h themedImage--light_AouX navbar__logo"><img src="/img/favicon.ico" alt="Data Science Research Infrastructure" class="themedImage_2E_h themedImage--dark_1YPN navbar__logo"><strong class="navbar__title">Data Science Research Infrastructure</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Documentation</a><a class="navbar__item navbar__link" href="/help">Help</a><a class="navbar__item navbar__link" href="/acknowledgement">Acknowledgement</a><a class="navbar__item navbar__link" href="/contributing">Contribute</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/MaastrichtU-IDS/dsri-documentation" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">üåú</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">üåû</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><div class="navbar__search searchBarContainer_1-U_"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_18Th searchBarLoadingRing_zYFK"><div></div><div></div><div></div><div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/favicon.ico" alt="Data Science Research Infrastructure" class="themedImage_2E_h themedImage--light_AouX navbar__logo"><img src="/img/favicon.ico" alt="Data Science Research Infrastructure" class="themedImage_2E_h themedImage--dark_1YPN navbar__logo"><strong class="navbar__title">Data Science Research Infrastructure</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/">Documentation</a></li><li class="menu__list-item"><a class="menu__link" href="/help">Help</a></li><li class="menu__list-item"><a class="menu__link" href="/acknowledgement">Acknowledgement</a></li><li class="menu__list-item"><a class="menu__link" href="/contributing">Contribute</a></li><li class="menu__list-item"><a href="https://github.com/MaastrichtU-IDS/dsri-documentation" target="_blank" rel="noopener noreferrer" class="menu__link header-github-link"></a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive thin-scrollbar menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Get started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/access-dsri">Access the DSRI</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/start-workspace">Start your workspace</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openshift-install">Install the client</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openshift-load-data">Upload data</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openshift-delete-services">Delete an application</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/guide-monitoring">Monitor your applications</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Deploy applications</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guide-dockerfile-to-openshift">Deploy from a Dockerfile</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/deploy-from-docker">Deploy from a Docker image</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/anatomy-of-an-application">Anatomy of a DSRI application</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/helm">Install from Helm charts</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/operators">Install from Operators</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">Data Science catalog</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/deploy-jupyter">Jupyter Notebooks</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/deploy-rstudio">RStudio</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/deploy-vscode">VisualStudio Code</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/deploy-database">Databases</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/deploy-matlab">Matlab</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/jupyterhub-spark">JupyterHub with Spark cluster</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/deploy-spark">Spark cluster</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/mpi-jobs">Run MPI jobs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/neuroscience">Neuroscience research</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/catalog-genomics">Genomics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/catalog-imaging">Imaging softwares</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/deploy-on-gpu">GPU applications</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/catalog-utilities">Utilities</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Guides</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/prepare-project-for-dsri">Prepare your project</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/guide-vpn">Install UM VPN</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/guide-workshop">Prepare a workshop</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/guide-known-issues">Known Issues</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/project-management">Create a new Project</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/login-docker-registry">Login to Docker registries</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openshift-commands">Command Line Interface</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openshift-storage">Data storage</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/guide-publish-image">Publish a Docker image</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/openshift-delete-objects">Delete objects (advanced)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tools-machine-learning">Libraries for Machine Learning</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/glossary">Glossary</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Workflows</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/workflows-introduction">Introduction to workflows</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/workflows-github-actions">Deploy GitHub Runners</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/workflows-airflow">Deploy Airflow</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/workflows-argo">Run Argo workflows</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/workflows-nextflow">Run Nextflow workflows</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/workflows-cwl">Run CWL workflows</a></li></ul></li></ul></li></ul></div><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_2Tub"></button></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_39qw"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">JupyterHub with Spark cluster</h1></header><div class="markdown"><p>JupyterHub is ideal to enable multiple users easily start predefined workspaces in the same project. The complimentary Apache Spark cluster can be used from the workspaces to perform distributed processing.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="-install-kfctl"></a>üßä Install kfctl<a class="hash-link" href="#-install-kfctl" title="Direct link to heading">#</a></h2><p>You will need to have the usual <code>oc</code> tool installed, and to install <code>kfctl</code> on your machine, a tool to deploy Kubeflow applications, download the <a href="https://github.com/kubeflow/kfctl/releases" target="_blank" rel="noopener noreferrer">latest version for your OS üì•Ô∏è</a> </p><p>You can then install it by downloading the binary and putting it in your path, for example on Linux:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-bash codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">wget</span><span class="token plain"> https://github.com/kubeflow/kfctl/releases/download/v1.2.0/kfctl_v1.2.0-0-gbc038f9_linux.tar.gz</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">tar</span><span class="token plain"> -xzf kfctl_v1.2.0-0-gbc038f9_linux.tar.gz</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">mv</span><span class="token plain"> kfctl /usr/local/bin/</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>Clone the repository with the DSRI custom images and deployments for the OpenDataHub platform, and go to the <code>kfdef</code> folder:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-bash codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">git</span><span class="token plain"> clone https://github.com/MaastrichtU-IDS/odh-manifests</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">cd</span><span class="token plain"> odh-manifests/kfdef</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="-deploy-jupyterhub-and-spark"></a>ü™ê Deploy JupyterHub and Spark<a class="hash-link" href="#-deploy-jupyterhub-and-spark" title="Direct link to heading">#</a></h2><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Go the the kfdef folder</h5></div><div class="admonition-content"><p>All scripts need to be run from the <code>kfdef</code> folder üìÇ</p></div></div><p>You can deploy JupyterHub with 2 different authentications system, use the file corresponding to your choice:</p><ul><li><p>For the default DSRI authentication use <code>kfctl_openshift_dsri.yaml</code></p></li><li><p>For GitHub authentication use <code>kfctl_openshift_github.yaml</code></p><ul><li><p>You need to create a new GitHub OAuth app: <a href="https://github.com/settings/developers" target="_blank" rel="noopener noreferrer">https://github.com/settings/developers</a></p></li><li><p>And provide the GitHub client ID and secret through environment variable before running the start script:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-bash codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token builtin class-name" style="color:rgb(255, 203, 107)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">GITHUB_CLIENT_ID</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">YOUR_CLIENT_ID</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">GITHUB_CLIENT_SECRET</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">YOUR_CLIENT_SECRET</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div></li></ul></li></ul><p>First you will need to change the <code>namespace:</code> in the file you want to deploy, to provide the project where you want to start JupyterHub (currently <code>opendatahub-ids</code>), then you can deploy JupyterHub and Spark with <code>kfctl</code>:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-bash codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">./start_odh.sh kfctl_openshift_dsri.yaml</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>üóÑÔ∏è Persistent volumes are automatically created for each instance started in JupyterHub to insure persistence of the data even JupyterHub is stopped. You can find the persistent volumes in the DSRI web UI, go to the <strong>Administrator</strong> view &gt; <strong>Storage</strong> &gt; <strong>Persistent Volume Claims</strong>.</p><p>‚ö°Ô∏è A Spark cluster with 3 workers is automatically created with the service name <code>spark-cluster</code>, you can use the URL of the master node to access it from your workspace: <code>spark://spark-cluster:7077</code></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="-use-the-spark-cluster"></a>‚ú® Use the Spark cluster<a class="hash-link" href="#-use-the-spark-cluster" title="Direct link to heading">#</a></h2><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>Matching Spark versions</h5></div><div class="admonition-content"><p>Make sure all the Spark versions are matching, the current default version is <code>3.0.1</code></p></div></div><p>You can test the Spark cluster connection with PySpark:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-python codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> pyspark</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sql </span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> SparkSession</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> SQLContext</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> os</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> socket</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Create a Spark session</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">spark_cluster_url </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;spark://spark-cluster:7077&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">spark </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> SparkSession</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">builder</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">master</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">spark_cluster_url</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">getOrCreate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">sc </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> spark</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sparkContext</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Test your Spark connection</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">spark</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token builtin" style="color:rgb(130, 170, 255)">range</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> numPartitions</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">rdd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token builtin" style="color:rgb(130, 170, 255)">map</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">lambda</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> socket</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">gethostname</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">distinct</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">collect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Or try:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#x = [&#x27;spark&#x27;, &#x27;rdd&#x27;, &#x27;example&#x27;, &#x27;sample&#x27;, &#x27;example&#x27;]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">x </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">y </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> sc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">parallelize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">collect</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Or try:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">data </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">distData </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> sc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">parallelize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">distData</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token builtin" style="color:rgb(130, 170, 255)">reduce</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">lambda</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> a </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="match-the-version"></a>Match the version<a class="hash-link" href="#match-the-version" title="Direct link to heading">#</a></h3><p>Make sure all the Spark versions are matching, the current default version is <code>3.0.1</code>:</p><ul><li>Go to the Spark UI to verify the version of the Spark cluster</li><li>Run <code>spark-shell --version</code> to verify the version of the Spark binary installed in the workspace</li><li>Run <code>pip list | grep pyspark</code> to verify the version of the PySpark library</li></ul><p>Check the <a href="https://github.com/MaastrichtU-IDS/jupyterlab/blob/main/Dockerfile#L14" target="_blank" rel="noopener noreferrer">JupyterLab workspace <code>Dockerfile</code></a> to change the version of Spark installed in the workspace, and see how you can download and install a new version of the Spark binary.</p><p>If you need to change the Python, Java or PySpark version in the workspace you can create a <code>environment.yml</code> file, for example for <code>2.4.5</code>:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-yaml codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> spark</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">channels</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> defaults</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> conda</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">forge</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> anaconda</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">dependencies</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> python=3.7</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> openjdk=8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> ipykernel </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> nb_conda_kernels</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> pip</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">pip</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> pyspark==2.4.5</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>Create the environment with <code>conda</code>:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-bash codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">mamba </span><span class="token function" style="color:rgb(130, 170, 255)">env</span><span class="token plain"> create -f environment.yml</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="spark-ui"></a>Spark UI<a class="hash-link" href="#spark-ui" title="Direct link to heading">#</a></h3><p>You can also create a route to access the Spark UI and monitor the activity on the Spark cluster:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-bash codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">oc expose svc/spark-cluster-ui</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>Get the Spark UI URL:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-bash codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">oc get route --selector radanalytics.io/service</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">ui --no-headers -o</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">custom-columns</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">HOST:.spec.host</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="new-spark-cluster"></a>New Spark cluster<a class="hash-link" href="#new-spark-cluster" title="Direct link to heading">#</a></h3><p>You can create a new Spark cluster, for example here using Spark <code>3.0.1</code> with the installed Spark Operator:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-bash codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">cat</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;&lt;</span><span class="token string" style="color:rgb(195, 232, 141)">EOF</span><span class="token string bash punctuation" style="color:rgb(199, 146, 234)"> </span><span class="token string bash punctuation operator" style="color:rgb(137, 221, 255)">|</span><span class="token string bash punctuation" style="color:rgb(199, 146, 234)"> oc apply -f -</span><span class="token string" style="color:rgb(195, 232, 141)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">apiVersion: radanalytics.io/v1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">kind: SparkCluster</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">metadata:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">  name: spark-cluster-301</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">spec:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">  customImage: quay.io/radanalyticsio/openshift-spark:3.0.1-2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">  worker:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">    instances: &#x27;4&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">    memory: &quot;2Gi&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">    cpu: 2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">  master:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">    instances: &#x27;1&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">    memory: &quot;2Gi&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">    cpu: 2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">  env:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">  - name: SPARK_WORKER_CORES</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">    value: 2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">EOF</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>You can browse the list of available <a href="https://quay.io/repository/radanalyticsio/openshift-spark?tag=latest&amp;tab=tags" target="_blank" rel="noopener noreferrer">image versions here</a></p><p>See the Radanalytics <a href="https://github.com/radanalyticsio/spark-operator/blob/master/examples/cluster-with-config.yaml" target="_blank" rel="noopener noreferrer">Spark operator example configuration</a> for more details on the Spark cluster configuration. </p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="Ô∏è-delete-the-deployment"></a>üóëÔ∏è Delete the deployment<a class="hash-link" href="#Ô∏è-delete-the-deployment" title="Direct link to heading">#</a></h2><p>Delete the running JupyterHub application and Spark cluster, including persistent volumes:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-bash codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">./delete_odh.sh kfctl_openshift_dsri.yaml</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/MaastrichtU-IDS/dsri-documentation/edit/master/website/docs/jupyterhub-spark.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col text--right"><em><small>Last updated on <time datetime="2022-02-18T14:25:22.000Z" class="docLastUpdatedAt_217_">2/18/2022</time> by <strong>Vincent Emonet</strong></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/deploy-matlab"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">¬´ Matlab</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/deploy-spark"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Spark cluster ¬ª</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_ thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#-install-kfctl" class="table-of-contents__link">üßä Install kfctl</a></li><li><a href="#-deploy-jupyterhub-and-spark" class="table-of-contents__link">ü™ê Deploy JupyterHub and Spark</a></li><li><a href="#-use-the-spark-cluster" class="table-of-contents__link">‚ú® Use the Spark cluster</a><ul><li><a href="#match-the-version" class="table-of-contents__link">Match the version</a></li><li><a href="#spark-ui" class="table-of-contents__link">Spark UI</a></li><li><a href="#new-spark-cluster" class="table-of-contents__link">New Spark cluster</a></li></ul></li><li><a href="#Ô∏è-delete-the-deployment" class="table-of-contents__link">üóëÔ∏è Delete the deployment</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="text--center"><div><a href="https://creativecommons.org/licenses/by/4.0/" title="Creative Commons Attribution 4.0 International license" target="_blank" rel="noopener noreferrer"><img src="/dsri-documentation/img/cc-by.svg" alt="cc by license"></a></div><div style="margin-bottom:10px">Copyright ¬© 2021 <a href="https://maastrichtuniversity.nl/ids" target="_blank" rel="noopener noreferrer">Institute of Data Science</a> at Maastricht University</div><div style="margin-bottom:10px;color:grey">We don&#x27;t use any tracker, enjoy the freedom and peace of mind üïäÔ∏è</div></div></div></footer></div>
<script src="/styles.70887d1f.js"></script>
<script src="/runtime~main.57c8563e.js"></script>
<script src="/main.07e63e00.js"></script>
<script src="/1.e90966bd.js"></script>
<script src="/1f391b9e.f6253f77.js"></script>
<script src="/81.99b39d61.js"></script>
<script src="/935f2afb.b50e0861.js"></script>
<script src="/79.9c645739.js"></script>
<script src="/3a93ea81.bd3bc90e.js"></script>
</body>
</html>